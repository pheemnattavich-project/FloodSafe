<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyJjx7WWFFPP6R0akKxmsfxGSg4vOfAxRUJ8bpnHiQ198OPeDxm0vVHDMo_6ZEwAP95/exec";

let lat = "", lng = "";

navigator.geolocation.getCurrentPosition(
  pos => {
    lat = pos.coords.latitude;
    lng = pos.coords.longitude;
  },
  err => {
    console.warn("р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Гр╕лр╣Йр╣Гр╕Кр╣Й GPS");
  }
);

function send() {
  const payload = {
    name: name.value.trim(),
    phone: phone.value.trim(),
    location: location.value.trim(),
    helpType: helpType.value,
    description: description.value.trim(),
    lat,
    lng
  };

  if (!payload.name || !payload.phone || !payload.location) {
    alert("р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ");
    return;
  }

  fetch(scriptURL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"   // тЬЕ р╕кр╕│р╕Др╕▒р╕Нр╕бр╕▓р╕Б
    },
    body: JSON.stringify(payload)
  })
  .then(res => res.text())   // ЁЯСИ р╕нр╕вр╣Ир╕▓р╣Гр╕Кр╣Й res.json()
  .then(text => {
    console.log("Response:", text);
    alert("тЬЕ р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з");

    // reset form
    document.querySelectorAll("input, textarea").forEach(el => el.value = "");
    helpType.value = "";
  })
  .catch(err => {
    console.error(err);
    alert("тЭМ р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И");
  });
}
</script>
